<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.kmarket.dao.ProductDAO">
    <select id="getCateName" resultType="kr.co.kmarket.vo.product_cate2VO">
        SELECT a.c1Name, b.c2Name FROM `km_product_cate1` AS a
        JOIN `km_product_cate2` AS b
        ON a.cate1 = b.cate1 WHERE b.cate1=#{cate1} AND b.cate2=#{cate2};
    </select>
    <select id="getCountTotal" resultType="int">
        SELECT COUNT(`prodNo`) FROM `km_product` WHERE `prodCate1`=#{cate1} AND `prodCate2`=#{cate2};
    </select>
    <select id="selectProducts" resultType="kr.co.kmarket.vo.productVO">
        SELECT * FROM `km_product` WHERE `prodCate1`=#{cate1} AND `prodCate2`=#{cate2}

        <if test="sort == 'sold'">
            ORDER BY `sold` DESC LIMIT #{start}, 10;
        </if>

        <if test="sort == 'lowprice'">
            ORDER BY `price` ASC LIMIT #{start}, 10;
        </if>

        <if test="sort == 'highprice'">
            ORDER BY `price` DESC LIMIT #{start}, 10;
        </if>

        <if test="sort == 'score'">
            ORDER BY `score` DESC LIMIT #{start}, 10;
        </if>

        <if test="sort == 'review'">
            ORDER BY `review` DESC LIMIT #{start}, 10;
        </if>

        <if test="sort == 'rdate'">
            ORDER BY `rdate` DESC LIMIT #{start}, 10;
        </if>

    </select>

    <select id="selectProduct" resultType="kr.co.kmarket.vo.productVO">
        select * from `km_product` where `prodNo`=#{prodNo};
    </select>

    <insert id="addCart">
        INSERT INTO `km_product_cart`(`uid`, `prodNo`, `count`, `price`, `discount`, `point`, `delivery`, `total`, `rdate`)
        VALUES(#{uid}, #{prodNo}, #{count}, #{price}, #{discount}, #{point}, #{delivery}, #{total}, NOW());
    </insert>

    <update id="updateProductHit">
        UPDATE `km_product` SET `hit` = `hit`+ 1 WHERE `prodNo`=#{prodNo};
    </update>

</mapper>